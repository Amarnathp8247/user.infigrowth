import{r as x,j as s,B as w,n as V,T as g,I as T,bp as B,bq as W,br as F,y as M,bs as R,aG as D,bt as E,ac as v,aI as N,a as O,bu as G,ae as H,a8 as K,a9 as _,a6 as $,S as Q,V as A,W as J,f as U,a7 as X,b9 as k,s as q}from"./index-D1uGZ479.js";import{K as Y}from"./KeyboardArrowDown-rOuSl0HJ.js";function Z(r,n=300){const[i,m]=x.useState(r);return x.useEffect(()=>{const a=setTimeout(()=>m(r),n);return()=>clearTimeout(a)},[r,n]),i}function ee({items:r=[],value:n,onChange:i,width:m,onSearchChange:a,shouldBeFullwidth:p=!1,isLoading:C=!1,getOptionLabel:b=u=>u.name||u.label||"",multiple:l=!1,disabled:t=!1}){var S;const u=x.useRef(null),[L,j]=x.useState(!1),[f,I]=x.useState(""),y=Z(f);x.useEffect(()=>{a&&a(y)},[y]);const d=l?r.filter(e=>(n||[]).includes(e.value)):r.find(e=>e.value===n),h=e=>{if(!t)if(l){const c=n!=null&&n.includes(e.value)?n.filter(o=>o!==e.value):[...n||[],e.value];i(c)}else i(e.value),j(!1)},z=r.filter(e=>b(e).toLowerCase().includes(f.toLowerCase())),P=()=>{t||(i(l?[]:null),I(""),a&&a(""))};return s.jsxs(w,{children:[s.jsx(V,{sx:{width:{xs:"100%",sm:m||"100%"}},fullWidth:p,variant:"outlined",size:"small",disabled:!0,children:s.jsxs(w,{ref:u,onClick:()=>!t&&j(e=>!e),sx:{display:"flex",alignItems:"center",justifyContent:"space-between",border:"1px solid #ccc",borderRadius:"4px",px:2,py:1,cursor:t?"not-allowed":"pointer",bgcolor:t?"#f5f5f5":"inherit",opacity:t?.6:1,minHeight:"40px",flexWrap:"wrap",gap:"4px"},children:[s.jsx(g,{children:l?d.length?d.map(b).join(", "):"Please choose...":d?b(d):"Please choose..."}),l&&d.length>0&&s.jsx(T,{size:"small",onClick:e=>{e.stopPropagation(),P()},children:s.jsx(B,{fontSize:"small"})}),s.jsx(Y,{})]})}),!t&&s.jsx(W,{open:L,anchorEl:u.current,placement:"bottom-start",style:{zIndex:1300,width:(S=u.current)==null?void 0:S.offsetWidth},children:s.jsx(F,{onClickAway:()=>j(!1),children:s.jsxs(M,{children:[s.jsx(w,{px:1,py:1,children:s.jsx(R,{placeholder:"Search...",fullWidth:!0,value:f,onChange:e=>I(e.target.value),onMouseDown:e=>e.stopPropagation(),endAdornment:f&&s.jsx(D,{position:"end",children:s.jsx(T,{size:"small",onClick:()=>{I(""),a&&a("")},children:s.jsx(B,{fontSize:"small"})})}),sx:{border:"1px solid #ccc",borderRadius:"4px",px:1,py:.5}})}),s.jsx(E,{sx:{overflow:"auto",maxHeight:"300px"},children:C?s.jsxs(v,{disabled:!0,children:[s.jsx(N,{size:18,sx:{mr:1}})," Loading..."]}):z.length?z.map((e,c)=>s.jsx(v,{selected:l?n==null?void 0:n.includes(e.value):e.value===n,onClick:()=>h(e),children:s.jsx(g,{children:b(e)})},c)):s.jsx(v,{disabled:!0,children:"No results"})})]})})})]})}const se=$({planId:k({required_error:"Plan is required"}).nullable().refine(r=>r!==null,{message:"Plan is required"}),userId:k({required_error:"Sub IB is required"}).nullable().refine(r=>r!==null,{message:"Sub IB is required"}),amount:X().min(1,"Please type override amount")});function oe({data:r,onClose:n}){var P,S;const i=O(),[m,{isLoading:a}]=G(),[p,C]=x.useState(""),l={planId:Number(r==null?void 0:r.planId)||null,userId:null,amount:""},{data:t,isFetching:u}=H(),L=((S=(P=t==null?void 0:t.data)==null?void 0:P.userList)==null?void 0:S.filter(e=>{var c,o;return(e==null?void 0:e.isSubIb)&&((o=(c=e==null?void 0:e.userName)==null?void 0:c.toLowerCase())==null?void 0:o.includes(p==null?void 0:p.toLowerCase()))}))||[],{watch:j,register:f,setValue:I,reset:y,handleSubmit:d,formState:{errors:h}}=K({resolver:_(se),defaultValues:l}),z=async e=>{var c;try{const o=await m({...e,login:r==null?void 0:r.mt5LoginId}).unwrap();o!=null&&o.status&&(i(q({open:!0,message:o==null?void 0:o.message,severity:"success"})),y(l),n())}catch(o){i(q({open:!0,message:((c=o==null?void 0:o.data)==null?void 0:c.message)||"Failed to submit. Please try again later.",severity:"error"}))}};return s.jsxs(Q,{component:"form",onSubmit:d(z),children:[s.jsx(g,{variant:"h5",fontWeight:"700",fontSize:"1.8rem",mb:"20px",children:"Override Commission"}),s.jsxs(w,{children:[s.jsx(A,{sx:{mb:".2rem",fontSize:"12px"},children:"Sub IB *"}),s.jsx(ee,{width:"100%",items:L.map(e=>({value:e.id,name:`${e.name} (${e.userName})`})),value:j("userId"),onChange:e=>I("userId",e,{shouldValidate:!0}),onSearchChange:e=>C(e),isLoading:u,shouldBeFullwidth:!0}),h.userId&&s.jsx(g,{color:"error",fontSize:"14px",children:h.userId.message})]}),s.jsxs(w,{mt:"20px",children:[s.jsx(A,{sx:{mb:".2rem",fontSize:"12px"},children:"Amount *"}),s.jsx(J,{placeholder:"Amount to override",size:"small",fullWidth:!0,...f("amount")}),h.amount&&s.jsx(g,{color:"error",fontSize:"14px",children:h.amount.message})]}),s.jsx(U,{variant:"contained",type:"submit",disabled:a,sx:{textTransform:"capitalize",width:"5rem",boxShadow:"none",color:"white",mt:"1.5rem","&:hover":{boxShadow:"none"}},children:"Submit"})]})}export{oe as O};
