import{a as L,q as w,b as B,r as $,a8 as G,bN as W,bD as H,j as s,S as O,T as o,B as v,L as N,f as U,bG as I,bE as m,bF as f,s as c}from"./index-D1uGZ479.js";import{C as q,O as K}from"./OTPInput-DZMqfUt-.js";import{u as Q}from"./useCountdownTimer-DBqZnIUK.js";function Z({onClose:u}){var g,b;const a=L(),{resendOtpCreatedTime:T,resendOtpExpiryTime:E}=w(n=>n.auth),p=Q(T,E,()=>{a(m(null)),a(f(null))}),C=p<=0,M=n=>{const i=String(Math.floor(n/60)).padStart(2,"0"),e=String(n%60).padStart(2,"0");return`${i}:${e}`},{token:k}=w(n=>n.auth),{data:r,isLoading:y,refetch:d}=B(void 0,{skip:!k,refetchOnMountOrArgChange:!0}),l=!y&&((b=(g=r==null?void 0:r.data)==null?void 0:g.userData)==null?void 0:b.mobile),h=$.useRef(!1),S={mobile:l,otp:""},{handleSubmit:j,setValue:D,watch:V}=G({defaultValues:S}),[z]=W(),R=()=>{typeof u=="function"?u():a(I("personalInfoVerification"))},x=async n=>{var i,e;try{const t=await z(n).unwrap();t!=null&&t.status&&(d(),R(),a(m(null)),a(f(null)),a(c({open:!0,message:t==null?void 0:t.message,severity:"success"})))}catch(t){(i=t==null?void 0:t.data)!=null&&i.status||a(c({open:!0,message:((e=t==null?void 0:t.data)==null?void 0:e.message)||"Failed to submit. Please try again later.",severity:"error"}))}finally{h.current=!1}},[A]=H(),P=async()=>{var n,i;try{const e=await A({mobile:l}).unwrap();if(e!=null&&e.status){const t=Date.now(),F=t+2*60*1e3;a(m(t)),a(f(F)),a(c({open:!0,message:e==null?void 0:e.message,severity:"success"}))}}catch(e){(n=e==null?void 0:e.data)!=null&&n.status||a(c({open:!0,message:((i=e==null?void 0:e.data)==null?void 0:i.message)||"Failed to submit. Please try again later.",severity:"error"}))}};return s.jsxs(O,{sx:{gap:"1.2rem"},component:"form",onSubmit:j(x),children:[s.jsx(o,{sx:{fontWeight:600,lineHeight:"32px",fontSize:"28px"},children:"Confirm phone number"}),s.jsxs(O,{sx:{flexDirection:"row",gap:"1rem"},children:[s.jsx(q,{}),s.jsxs(v,{children:[s.jsx(o,{children:"Enter the code we sent to:"}),s.jsx(o,{fontWeight:"bold",children:l})]})]}),s.jsx(K,{value:V("otp"),onComplete:n=>{D("otp",n),h.current||(h.current=!0,j(x)())}}),s.jsxs(v,{children:[C?s.jsx(o,{onClick:P,sx:{cursor:"pointer",textDecoration:"underline",fontSize:"14px",color:"blue"},children:"Resend code"}):s.jsx(o,{fontSize:"14px",color:"textSecondary",children:`Get a new code in: ${M(p)}`}),s.jsx(o,{component:N,fontSize:"14px",color:"blue",children:"I didn't receive a code"})]}),typeof u!="function"&&s.jsx(U,{variant:"contained",type:"submit",disabled:y,onClick:()=>a(I("phoneVerification")),sx:{textTransform:"capitalize",boxShadow:"none",color:"black",bgcolor:"#dfdfdf",alignSelf:"self-end","&:hover":{boxShadow:"none",bgcolor:"#dfdfdf"}},children:"Back"})]})}function _({onClose:u}){var g,b;const a=L(),{resendOtpCreatedTime:T,resendOtpExpiryTime:E}=w(n=>n.auth),p=Q(T,E,()=>{a(m(null)),a(f(null))}),C=p<=0,M=n=>{const i=String(Math.floor(n/60)).padStart(2,"0"),e=String(n%60).padStart(2,"0");return`${i}:${e}`},{token:k}=w(n=>n.auth),{data:r,refetch:y}=B(void 0,{skip:!k,refetchOnMountOrArgChange:!0}),d=(b=(g=r==null?void 0:r.data)==null?void 0:g.userData)==null?void 0:b.email,l=$.useRef(!1),h={email:"",otp:""},{handleSubmit:S,setValue:j,reset:D,watch:V}=G({defaultValues:h});$.useEffect(()=>{D({email:d})},[d]);const[z]=W(),R=()=>{typeof u=="function"?u():a(I("phoneVerification"))},x=async n=>{var i,e;try{const t=await z(n).unwrap();t!=null&&t.status&&(y(),R(),a(m(null)),a(f(null)),a(c({open:!0,message:t==null?void 0:t.message,severity:"success"})))}catch(t){(i=t==null?void 0:t.data)!=null&&i.status||a(c({open:!0,message:((e=t==null?void 0:t.data)==null?void 0:e.message)||"Failed to submit. Please try again later.",severity:"error"}))}finally{l.current=!1}},[A]=H(),P=async()=>{var n,i;try{const e=await A({email:d}).unwrap();if(e!=null&&e.status){const t=Date.now(),F=t+2*60*1e3;a(m(t)),a(f(F)),a(c({open:!0,message:e==null?void 0:e.message,severity:"success"}))}}catch(e){(n=e==null?void 0:e.data)!=null&&n.status||a(c({open:!0,message:((i=e==null?void 0:e.data)==null?void 0:i.message)||"Failed to submit. Please try again later.",severity:"error"}))}};return s.jsxs(O,{sx:{gap:"1.2rem"},component:"form",onSubmit:S(x),children:[s.jsx(o,{sx:{fontWeight:600,lineHeight:"32px",fontSize:"28px"},children:"Confirm email"}),s.jsxs(O,{sx:{flexDirection:"row",gap:"1rem"},children:[s.jsx(q,{}),s.jsxs(v,{children:[s.jsx(o,{children:"Enter the code we sent to:"}),s.jsx(o,{fontWeight:"bold",children:d||null})]})]}),s.jsx(K,{value:V("otp"),onComplete:n=>{j("otp",n),l.current||(l.current=!0,S(x)())}}),s.jsxs(v,{children:[C?s.jsx(o,{onClick:P,sx:{cursor:"pointer",textDecoration:"underline",fontSize:"14px",color:"blue"},children:"Resend code"}):s.jsx(o,{fontSize:"14px",color:"textSecondary",children:`Get a new code in: ${M(p)}`}),s.jsx(o,{component:N,fontSize:"14px",color:"blue",children:"I didn't receive a code"})]})]})}export{_ as E,Z as P};
