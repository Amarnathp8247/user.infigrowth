import{r as g,q as b,j as i,S as y,T as m,c as T,a as j,ca as z,I as U,v as E,Y as L,s as O,cb as R,cc as F,u as B,M as H,b2 as M,B as P,y as v}from"./index-D1uGZ479.js";function G(){const{selectedSymbol:e}=b(t=>t.terminal),s=g.useRef();return g.useEffect(()=>{if(!s.current)return;s.current.innerHTML="";const t=document.createElement("script");t.src="https://s3.tradingview.com/external-embedding/embed-widget-advanced-chart.js",t.type="text/javascript",t.async=!0,t.innerHTML=`
        {
          "allow_symbol_change": true,
          "calendar": false,
          "details": false,
          "hide_side_toolbar": false,
          "hide_top_toolbar": true,
          "hide_legend": false,
          "hide_volume": true,
          "hotlist": false,
          "interval": "5",
          "locale": "en",
          "save_image": false,
          "style": "1",
          "symbol": "OANDA:${e==null?void 0:e.name}",
          "theme": "dark",
          "timezone": "Etc/UTC",
          "backgroundColor": "#0F0F0F",
          "gridColor": "rgba(242, 242, 242, 0.06)",
          "watchlist": [
            "OANDA:AUDJPY",
            "OANDA:AUDNZD",
            "OANDA:AUDUSD",
            "OANDA:CADCHF",
            "OANDA:CADJPY",
            "OANDA:CHFJPY",
            "OANDA:EURAUD",
            "OANDA:EURCAD",
            "OANDA:EURCHF",
            "OANDA:EURGBP",
            "OANDA:EURJPY",
            "OANDA:EURNZD",
            "OANDA:EURUSD",
            "OANDA:GBPAUD",
            "OANDA:GBPCAD",
            "OANDA:GBPCHF",
            "OANDA:GBPJPY",
            "OANDA:GBPNZD",
            "OANDA:GBPUSD",
            "OANDA:NZDCAD",
            "OANDA:NZDCHF",
            "OANDA:NZDJPY",
            "OANDA:NZDUSD",
            "OANDA:US30USD",
            "OANDA:USDCAD",
            "OANDA:USDCHF",
            "OANDA:USDJPY",
            "OANDA:USDNOK",
            "OANDA:XAGUSD",
            "OANDA:XAUUSD"
          ],
          "withdateranges": false,
          "compareSymbols": [],
          "studies": [],
          "autosize": true
        }`,s.current.appendChild(t)},[e]),e?i.jsx("div",{className:"tradingview-widget-container",ref:s,style:{height:"100%",width:"100%"},children:i.jsx("div",{className:"tradingview-widget-container__widget",style:{height:"calc(100% - 32px)",width:"100%"}})}):i.jsx(y,{sx:{height:"100%",justifyContent:"center",alignItems:"center"},children:i.jsx(m,{sx:{fontWeight:"bold",fontSize:"1rem"},children:"Please select a symbol"})})}const _=g.memo(G),n=T(),N={Open:{columns:[n.accessor("Position",{header:"Position",size:100}),n.accessor("Login",{header:"Log in",size:100}),n.accessor("Symbol",{header:"Symbol",size:100}),n.accessor("Action",{header:"Action",size:100,Cell:({row:e})=>{var t;const s=(t=e==null?void 0:e.original)==null?void 0:t.Action;return i.jsx(m,{sx:{color:s==1?"red":"green"},children:s==1?"Sell":"Buy"})}}),n.accessor("PriceOpen",{header:"Open price",size:100}),n.accessor("PriceCurrent",{header:"Current price",size:100}),n.accessor("PriceSL",{header:"SL price",size:100}),n.accessor("PriceTP",{header:"TP price",size:100}),n.accessor("Volume",{header:"Volume",size:100,Cell:({row:e})=>{var t;const s=(t=e==null?void 0:e.original)==null?void 0:t.Volume;return i.jsx(m,{children:s/1e4})}}),n.accessor("Profit",{header:"Profit",size:100,Cell:({row:e})=>{var t;const s=(t=e==null?void 0:e.original)==null?void 0:t.Profit;return i.jsx(m,{color:s.includes("-")?"red":"green",children:s})}}),n.accessor("TimeCreate",{header:"Created AT",size:200,Cell:({row:e})=>{const s=e.original.TimeCreate,o=new Date(s*1e3).toLocaleString("en-CA",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1}).replace(",","");return i.jsx(m,{children:o})}}),n.display({header:"Close trade",Cell:({row:e})=>{var l,f,x,u,A,C;const s=(l=e==null?void 0:e.original)==null?void 0:l.Symbol,t=j(),o={symbol:s,volume:(f=e==null?void 0:e.original)==null?void 0:f.Volume,typeFill:"1",type:((x=e==null?void 0:e.original)==null?void 0:x.Action)===1||((u=e==null?void 0:e.original)==null?void 0:u.Action)==="1"?"0":"1",login:(A=e==null?void 0:e.original)==null?void 0:A.Login,position:(C=e==null?void 0:e.original)==null?void 0:C.Position},[r,{isLoading:D}]=z(),d=async h=>{var p,c;try{const a=await r(h).unwrap();a!=null&&a.status&&t(O({open:!0,message:a==null?void 0:a.message,severity:"success"}))}catch(a){(p=a==null?void 0:a.data)!=null&&p.status||t(O({open:!0,message:((c=a==null?void 0:a.data)==null?void 0:c.message)||"Failed to submit. Please try again later.",severity:"error"}))}};return i.jsx(y,{sx:{flexDirection:"row",gap:"10px"},children:i.jsx(U,{onClick:()=>d(o),disabled:D,children:i.jsx(E,{title:"Close order",placement:"right",children:i.jsx(L,{})})})})},size:100})]},Closed:{columns:[n.accessor("Order",{header:"Order",size:40}),n.accessor("Login",{header:"Log in",size:40}),n.accessor("Symbol",{header:"Symbol",size:100}),n.accessor("Price",{header:"Price",size:100}),n.accessor("Volume",{header:"Volume",size:100,Cell:({row:e})=>{var t;const s=(t=e==null?void 0:e.original)==null?void 0:t.Volume;return i.jsx(m,{children:s/1e4})}}),n.accessor("Profit",{header:"Profit",size:100}),n.accessor("Action",{header:"Action",size:100,Cell:({row:e})=>{var t;const s=(t=e==null?void 0:e.original)==null?void 0:t.Action;return i.jsx(m,{sx:{color:s==1?"green":"red"},children:s==1?"Buy":"Sell"})}}),n.accessor("PriceSL",{header:"SL price",size:100}),n.accessor("PriceTP",{header:"TP price",size:100}),n.accessor("Time",{header:"Closed AT",size:200,Cell:({row:e})=>{const s=e.original.Time,o=new Date(s*1e3).toLocaleString("en-CA",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1}).replace(",","");return i.jsx(m,{children:o})}})]}},Y=(e,s,t,o)=>{const r=g.useRef(),d=R({login:o});return g.useEffect(()=>{if(!(!o||!t))return r.current&&r.current.disconnect(),r.current=F({login:o,token:t}),()=>{r.current&&r.current.disconnect()}},[e,o,t]),{Open:s,Closed:d}[e]??{data:[],isLoading:!1,isError:!1,error:[]}},k=Object.keys(N);function V(){var c;const[e,s]=g.useState("Open"),[t,o]=g.useState(""),{token:r}=b(a=>a.auth),{activeMT5AccountLogin:D,activeMT5AccountPositionsDetails:d}=b(a=>a.mt5),{data:l,isLoading:f,isError:x,error:u}=Y(e,d,r,D),A=l==null?void 0:l.data,C=(c=u==null?void 0:u.data)==null?void 0:c.message,h=N[e],p=B({columns:h==null?void 0:h.columns,data:e=="Open"?d||[]:A||[],enableColumnFilters:!1,enableSorting:!1,enableColumnActions:!1,enableGlobalFilter:!1,manualFiltering:!0,state:{globalFilter:t,isLoading:f},enablePagination:!1,onGlobalFilterChange:o,columnFilterDisplayMode:"popover",paginationDisplayMode:"pages",positionToolbarAlertBanner:"bottom",muiToolbarAlertBannerProps:x?{color:"error",children:C||"Error loading orders table."}:void 0,renderTopToolbarCustomActions:()=>i.jsx(M,{active:e,items:k,boxSx:{width:"100%"},onChange:(a,S)=>s(S)}),muiTableBodyCellProps:{sx:{padding:"10px",fontSize:"0.8rem"}},muiTableHeadCellProps:{sx:{padding:"10px",fontSize:"0.8rem"}}});return i.jsx(y,{sx:{overflow:"auto"},children:i.jsx(H,{table:p})})}function J({topContent:e,bottomContent:s}){const t=g.useRef(null),[o,r]=g.useState(70),D=d=>{d.preventDefault();const l=t.current,f=d.clientY,x=o,u=C=>{if(!l)return;const h=C.clientY-f,p=l.getBoundingClientRect().height;let c=(x/100*p+h)/p*100;c<10&&(c=10),c>90&&(c=90),r(c)},A=()=>{window.removeEventListener("mousemove",u),window.removeEventListener("mouseup",A)};window.addEventListener("mousemove",u),window.addEventListener("mouseup",A)};return i.jsxs(P,{ref:t,sx:{height:{xs:"calc(100vh - 56px)",sm:"calc(100vh - 64px)"},display:"flex",flexDirection:"column"},children:[i.jsx(v,{elevation:2,sx:{flexBasis:`${o}%`,flexGrow:0,flexShrink:0,overflow:"auto",bgcolor:"background.default",p:"5px"},children:e}),i.jsx(P,{onMouseDown:D,sx:{height:"6px",bgcolor:"grey.700",cursor:"row-resize","&:hover":{bgcolor:"grey.500"}}}),i.jsx(v,{elevation:2,sx:{flex:1,overflow:"auto",bgcolor:"background.paper",p:"5px"},children:s})]})}function q(){return i.jsx(J,{topContent:i.jsx(_,{}),bottomContent:i.jsx(V,{})})}export{q as default};
